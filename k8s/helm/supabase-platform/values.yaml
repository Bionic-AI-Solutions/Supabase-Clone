# Default values for supabase-platform
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  storageClass: "standard"
  
# Platform application configuration
platform:
  replicaCount: 2
  
  image:
    repository: your-registry/supabase-platform
    pullPolicy: IfNotPresent
    tag: "1.0.0"
  
  service:
    type: ClusterIP
    port: 3000
    
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: supabase-platform.yourdomain.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: supabase-platform-tls
        hosts:
          - supabase-platform.yourdomain.com
  
  env:
    NODE_ENV: production
    JWT_SECRET: "change-this-to-a-secure-random-string"
    OWNER_OPEN_ID: "your-owner-open-id"
    OWNER_NAME: "Platform Owner"
    
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
      
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# PostgreSQL configuration (Platform database)
postgresql:
  enabled: true
  auth:
    username: supabase_admin
    password: "change-this-secure-password"
    database: supabase_platform
  primary:
    persistence:
      enabled: true
      size: 20Gi
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi
  readReplicas:
    replicaCount: 1
    persistence:
      enabled: true
      size: 20Gi
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 500m
        memory: 1Gi

# PostgreSQL operator for tenant databases
# Requires CloudNativePG operator to be installed
tenantPostgres:
  enabled: true
  # Cluster configuration for tenant databases
  cluster:
    instances: 3
    storage:
      size: 100Gi
      storageClass: "fast-ssd"
    resources:
      limits:
        cpu: 4000m
        memory: 8Gi
      requests:
        cpu: 2000m
        memory: 4Gi
    postgresql:
      parameters:
        max_connections: "200"
        shared_buffers: "2GB"
        effective_cache_size: "6GB"
        maintenance_work_mem: "512MB"
        checkpoint_completion_target: "0.9"
        wal_buffers: "16MB"
        default_statistics_target: "100"
        random_page_cost: "1.1"
        effective_io_concurrency: "200"
        work_mem: "10MB"
        min_wal_size: "1GB"
        max_wal_size: "4GB"

# MinIO configuration (Object storage)
minio:
  enabled: true
  mode: distributed
  replicas: 4
  auth:
    rootUser: minio-admin
    rootPassword: "change-this-minio-password"
  persistence:
    enabled: true
    size: 100Gi
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  defaultBuckets: "platform-assets"
  
# Kong API Gateway configuration
kong:
  enabled: true
  env:
    database: "off"  # DB-less mode
    nginx_worker_processes: "2"
    proxy_access_log: /dev/stdout
    admin_access_log: /dev/stdout
    admin_gui_access_log: /dev/stdout
    portal_api_access_log: /dev/stdout
    proxy_error_log: /dev/stderr
    admin_error_log: /dev/stderr
    admin_gui_error_log: /dev/stderr
    portal_api_error_log: /dev/stderr
  ingressController:
    enabled: true
    installCRDs: false
  proxy:
    enabled: true
    type: LoadBalancer
  admin:
    enabled: true
    type: ClusterIP

# Database initialization
dbInit:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

# Monitoring (optional)
monitoring:
  enabled: false
  prometheus:
    enabled: false
  grafana:
    enabled: false

# Backup configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention: 30  # days
  storage:
    size: 50Gi
